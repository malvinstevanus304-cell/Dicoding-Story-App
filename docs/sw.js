const CACHE_NAME="story-app-cache-v8",BASE="/Dicoding-Story-App",urlsToCache=[`${BASE}/`,`${BASE}/index.html`,`${BASE}/offline.html`,`${BASE}/app.bundle.js`,`${BASE}/images/logo.png`];self.addEventListener("install",(e=>{console.log("[SW] Install event"),e.waitUntil(caches.open(CACHE_NAME).then((e=>e.addAll(urlsToCache))))})),self.addEventListener("activate",(e=>{console.log("[SW] Activate event"),e.waitUntil(caches.keys().then((e=>Promise.all(e.filter((e=>e!==CACHE_NAME)).map((e=>caches.delete(e)))))))})),self.addEventListener("fetch",(e=>{const t=e.request;"navigate"!==t.mode?"POST"===t.method&&t.url.includes("/api/")?e.respondWith(fetch(t.clone()).then((e=>(self.registration.showNotification("Story App",{body:"Data berhasil dikirim ke server!",icon:`${BASE_PATH}/images/logo.png`,badge:`${BASE_PATH}/images/logo.png`,vibrate:[100,50,100]}),e))).catch((e=>(console.error("[SW] POST gagal:",e),new Response(JSON.stringify({error:"Tidak bisa kirim data"}),{status:500,headers:{"Content-Type":"application/json"}}))))):e.respondWith(caches.match(t).then((e=>e||fetch(t)))):e.respondWith(fetch(t).catch((()=>caches.match(`${BASE_PATH}/offline.html`))))})),self.addEventListener("push",(e=>{console.log("[SW] Push event:",e);let t={};if(e.data)try{t=e.data.json()}catch{t={title:"Story App",message:e.data.text(),url:"/"}}const i={body:t.message||"Anda mendapat notifikasi baru!",icon:`${BASE_PATH}/images/logo.png`,badge:`${BASE_PATH}/images/logo.png`,vibrate:[100,50,100],data:{url:t.url||"/"},actions:[{action:"open",title:"Buka Aplikasi"},{action:"close",title:"Tutup"}]};e.waitUntil(self.registration.showNotification(t.title||"Story App",i))})),self.addEventListener("notificationclick",(e=>{e.notification.close(),"open"===e.action&&e.notification.data?.url?e.waitUntil(clients.openWindow(e.notification.data.url)):e.waitUntil(clients.openWindow(`${BASE_PATH}/`))}));